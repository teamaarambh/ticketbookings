<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Select Seats â€“ Aarambh</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // Firebase Config (Your details)
    const firebaseConfig = {
      apiKey: "AIzaSyCz5-f1FZMxcfs2yc29hXNLz9636Q2jjKg",
      authDomain: "aarambh-ticket-bookings.firebaseapp.com",
      databaseURL: "https://aarambh-ticket-bookings-default-rtdb.firebaseio.com",
      projectId: "aarambh-ticket-bookings",
      storageBucket: "aarambh-ticket-bookings.firebasestorage.app",
      messagingSenderId: "269445606104",
      appId: "1:269445606104:web:4ee4beecee2d77cd5f45ad"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Global vars
    let bookedSeats = new Set();
    let selectedSeats = [];
    let totalPrice = 0;

    const middleRows = [...Array(18)].map((_, i) => String.fromCharCode(65 + i)); // A-R
    const middleCols = Array.from({ length: 15 }, (_, i) => i + 1);

    // Fetch booked seats from Firestore
    async function fetchBookedSeats() {
      const querySnapshot = await getDocs(collection(db, "bookings"));
      const allSeats = [];
      querySnapshot.forEach(doc => {
        const seats = doc.data().seats || "";
        if (seats) {
          seats.split(",").forEach(s => allSeats.push(s.trim()));
        }
      });
      bookedSeats = new Set(allSeats);
    }

    // Create seat element
    function createSeat(section, rowLabel, seatNum) {
      const seatId = `${section}${rowLabel}${seatNum}`;
      const isPremium = section === "M" && rowLabel >= "A" && rowLabel <= "H";
      const price = isPremium ? 500 : 300;

      const seat = document.createElement("div");
      seat.classList.add("seat", isPremium ? "premium" : "economy");
      seat.dataset.seatId = seatId;
      seat.dataset.price = price;

      if (bookedSeats.has(seatId)) {
        seat.classList.add("booked");
        return seat;
      }

      seat.addEventListener("click", () => {
        if (selectedSeats.includes(seatId)) {
          selectedSeats = selectedSeats.filter(s => s !== seatId);
          totalPrice -= price;
          seat.classList.remove("selected");
        } else {
          selectedSeats.push(seatId);
          totalPrice += price;
          seat.classList.add("selected");
        }
        updateInfo();
      });

      return seat;
    }

    function updateInfo() {
      document.getElementById("selectedSeats").textContent =
        "Selected Seats: " + (selectedSeats.length ? selectedSeats.join(", ") : "None");
      document.getElementById("totalPrice").textContent =
        "Total Price: â‚¹" + totalPrice;
    }

    async function renderSeats() {
      await fetchBookedSeats();

      const seatMap = document.getElementById("seatMap");
      seatMap.textContent = "";

      const layoutWrapper = document.createElement("div");
      layoutWrapper.classList.add("seat-layout");

      const leftDiv = document.createElement("div");
      leftDiv.classList.add("division", "left");

      const middleDiv = document.createElement("div");
      middleDiv.classList.add("division", "middle");

      const rightDiv = document.createElement("div");
      rightDiv.classList.add("division", "right");

      middleRows.forEach((rowLabel, rowIndex) => {
        const sideSeats = Math.min(2 + rowIndex, 9);

        const leftRow = document.createElement("div");
        leftRow.classList.add("row");
        for (let i = 1; i <= sideSeats; i++) {
          leftRow.appendChild(createSeat("L", rowLabel, i));
        }
        leftDiv.appendChild(leftRow);

        const middleRow = document.createElement("div");
        middleRow.classList.add("row");
        middleCols.forEach(col => {
          middleRow.appendChild(createSeat("M", rowLabel, col));
        });
        middleDiv.appendChild(middleRow);

        const rightRow = document.createElement("div");
        rightRow.classList.add("row");
        for (let i = 1; i <= sideSeats; i++) {
          rightRow.appendChild(createSeat("R", rowLabel, i));
        }
        rightDiv.appendChild(rightRow);
      });

      layoutWrapper.append(leftDiv, middleDiv, rightDiv);
      seatMap.appendChild(layoutWrapper);
    }

    window.addEventListener("DOMContentLoaded", () => {
      renderSeats();

      document.getElementById("continueBtn").addEventListener("click", () => {
        if (selectedSeats.length === 0) {
          alert("Please select at least one seat to continue.");
          return;
        }
        sessionStorage.setItem("selectedSeats", JSON.stringify(selectedSeats));
        sessionStorage.setItem("totalPrice", totalPrice);
        window.location.href = "details.html";
      });
    });
  </script>
</head>
<body>
  <h2>Select Your Seats</h2>
  <div class="info" id="selectedSeats">Selected Seats: None</div>
  <div class="info" id="totalPrice">Total Price: â‚¹0</div>
  <div class="stage-banner">ðŸŽ­ STAGE</div>
  <div class="seat-map" id="seatMap">Loading seat mapâ€¦</div>
  <div class="seat-legend">
    <div class="legend-item"><div class="seat-icon premium"></div> Premium (â‚¹500)</div>
    <div class="legend-item"><div class="seat-icon economy"></div> Economy (â‚¹300)</div>
    <div class="legend-item"><div class="seat-icon booked"></div> Booked</div>
    <div class="legend-item"><div class="seat-icon selected"></div> Selected</div>
  </div>
  <button id="continueBtn">Continue</button>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Select Seats â€“ Aarambh</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // Firebase Config (Your details)
    const firebaseConfig = {
      apiKey: "AIzaSyCz5-f1FZMxcfs2yc29hXNLz9636Q2jjKg",
      authDomain: "aarambh-ticket-bookings.firebaseapp.com",
      databaseURL: "https://aarambh-ticket-bookings-default-rtdb.firebaseio.com",
      projectId: "aarambh-ticket-bookings",
      storageBucket: "aarambh-ticket-bookings.firebasestorage.app",
      messagingSenderId: "269445606104",
      appId: "1:269445606104:web:4ee4beecee2d77cd5f45ad"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Global vars
    let bookedSeats = new Set();
    let selectedSeats = [];
    let totalPrice = 0;

    const middleRows = [...Array(18)].map((_, i) => String.fromCharCode(65 + i)); // A-R
    const middleCols = Array.from({ length: 15 }, (_, i) => i + 1);

    // Fetch booked seats from Firestore
    async function fetchBookedSeats() {
      const querySnapshot = await getDocs(collection(db, "bookings"));
      const allSeats = [];
      querySnapshot.forEach(doc => {
        const seats = doc.data().seats || "";
        if (seats) {
          seats.split(",").forEach(s => allSeats.push(s.trim()));
        }
      });
      bookedSeats = new Set(allSeats);
    }

    // Create seat element
    function createSeat(section, rowLabel, seatNum) {
      const seatId = `${section}${rowLabel}${seatNum}`;
      const isPremium = section === "M" && rowLabel >= "A" && rowLabel <= "H";
      const price = isPremium ? 500 : 300;

      const seat = document.createElement("div");
      seat.classList.add("seat", isPremium ? "premium" : "economy");
      seat.dataset.seatId = seatId;
      seat.dataset.price = price;

      if (bookedSeats.has(seatId)) {
        seat.classList.add("booked");
        return seat;
      }

      seat.addEventListener("click", () => {
        if (selectedSeats.includes(seatId)) {
          selectedSeats = selectedSeats.filter(s => s !== seatId);
          totalPrice -= price;
          seat.classList.remove("selected");
        } else {
          selectedSeats.push(seatId);
          totalPrice += price;
          seat.classList.add("selected");
        }
        updateInfo();
      });

      return seat;
    }

    function updateInfo() {
      document.getElementById("selectedSeats").textContent =
        "Selected Seats: " + (selectedSeats.length ? selectedSeats.join(", ") : "None");
      document.getElementById("totalPrice").textContent =
        "Total Price: â‚¹" + totalPrice;
    }

    async function renderSeats() {
      await fetchBookedSeats();

      const seatMap = document.getElementById("seatMap");
      seatMap.textContent = "";

      const layoutWrapper = document.createElement("div");
      layoutWrapper.classList.add("seat-layout");

      const leftDiv = document.createElement("div");
      leftDiv.classList.add("division", "left");

      const middleDiv = document.createElement("div");
      middleDiv.classList.add("division", "middle");

      const rightDiv = document.createElement("div");
      rightDiv.classList.add("division", "right");

      middleRows.forEach((rowLabel, rowIndex) => {
        const sideSeats = Math.min(2 + rowIndex, 9);

        const leftRow = document.createElement("div");
        leftRow.classList.add("row");
        for (let i = 1; i <= sideSeats; i++) {
          leftRow.appendChild(createSeat("L", rowLabel, i));
        }
        leftDiv.appendChild(leftRow);

        const middleRow = document.createElement("div");
        middleRow.classList.add("row");
        middleCols.forEach(col => {
          middleRow.appendChild(createSeat("M", rowLabel, col));
        });
        middleDiv.appendChild(middleRow);

        const rightRow = document.createElement("div");
        rightRow.classList.add("row");
        for (let i = 1; i <= sideSeats; i++) {
          rightRow.appendChild(createSeat("R", rowLabel, i));
        }
        rightDiv.appendChild(rightRow);
      });

      layoutWrapper.append(leftDiv, middleDiv, rightDiv);
      seatMap.appendChild(layoutWrapper);
    }

    window.addEventListener("DOMContentLoaded", () => {
      renderSeats();

      document.getElementById("continueBtn").addEventListener("click", () => {
        if (selectedSeats.length === 0) {
          alert("Please select at least one seat to continue.");
          return;
        }
        sessionStorage.setItem("selectedSeats", JSON.stringify(selectedSeats));
        sessionStorage.setItem("totalPrice", totalPrice);
        window.location.href = "details.html";
      });
    });
  </script>
</body>
</html>
